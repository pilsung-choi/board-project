datasource db {
    provider = "postgresql"
    url      = env("DB_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  admin
  paidUser
  user
}

model User {
    id              Int             @id @default(autoincrement())
    email           String          @unique
    password        String?     
    role            Role            @default(user)
    createdMovies   Movie[]         
    likedMovies     MovieUserLike[]
    chats           Chat[]
    chatRooms       ChatRoom[]
}

model Movie {
    id              Int                 @id @default(autoincrement())
    title           String              @unique
    likeCount       Int                 @default(0)
    dislikeCount    Int                 @default(0)
    movieFilePath   String
    creator         User                @relation(fields: [creatorId], references: [id])
    creatorId       Int                 
    detail          MovieDetail         @relation(fields: [detailId], references: [id])
    detailId        Int                 @unique
    director        Director            @relation(fields: [directorId], references: [id])
    directorId      Int                 
    genres          Genre[]
    likedUsers      MovieUserLike[]
}

model MovieUserLike {
    isLike    Boolean         
    movie     Movie     @relation(fields: [movieId], references: [id])
    movieId   Int
    user      User      @relation(fields: [userId], references: [id])
    userId    Int

    @@id([movieId, userId])
}

model MovieDetail {
    id        Int      @id @default(autoincrement())
    detail    String          
    movie     Movie? 
}

model Chat {
    id          Int         @id @default(autoincrement())
    message     String    
    author      User        @relation(fields: [authorId], references: [id])
    authorId    Int
    chatRoom    ChatRoom    @relation(fields: [ChatRoomId], references: [id])
    ChatRoomId  Int
}

model ChatRoom {
    id      Int     @id @default(autoincrement())
    users   User[]
    chats   Chat[]
}

model Genre {
    id      Int     @id @default(autoincrement())
    name    String  @unique
    movies  Movie[]   
}

model Director {
    id              Int         @id @default(autoincrement())
    name            String      
    dob             DateTime
    nationality     String
    movies          Movie[]     
}